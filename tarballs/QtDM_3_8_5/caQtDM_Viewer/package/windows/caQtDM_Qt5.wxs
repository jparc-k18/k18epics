<?xml version="1.0" encoding="utf-8"?>
<?define CaQtDMVersion = '3.8.0.0' ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product Id="*" Name="caQtDM" Language="1033" Version="$(var.CaQtDMVersion)" Manufacturer="Paul Scherrer Institut" UpgradeCode="86ABEDAA-C06B-4485-9DF0-5EFE2EB497DD">
        <Package Description="caQTDM Windows Manager with Qt-Designer(5.3.1)" Comments="Displaymanager for EPICS with Qt(5.3.1)" InstallerVersion="405" Compressed="yes" Manufacturer="Paul Scherrer Institut Switzerland" Keywords="EPICS, Display, Network, Control" Platform="x64" InstallScope="perMachine" />
        <Media Id="1" Cabinet="simple.cab" EmbedCab="yes" />
        <Upgrade Id="86ABEDAA-C06B-4485-9DF0-5EFE2EB497DD">
            <UpgradeVersion OnlyDetect="yes" Minimum="$(var.CaQtDMVersion)" Property="NEWERVERSIONDETECTED" IncludeMinimum="no" />
            <UpgradeVersion OnlyDetect="no" Maximum="$(var.CaQtDMVersion)" Property="OLDERVERSIONBEINGUPGRADED" IncludeMaximum="no" />
        </Upgrade>
        <UIRef Id="WixUI_InstallDir" />
        <Property Id="INSTALLDIR" Secure="yes" />
        <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
        <Property Id="CAQTDM_VERSION" Value="$(var.CaQtDMVersion)" />
        <Property Id="WIXUI_EXITDIALOGOPTIONALTEXT" Value="NO EPICS and Firewall parameter set or changed!" />
        <!-- UIRef Id="WixUI_Minimal" /-->
        <Icon Id="StartMenuIcon.exe" SourceFile="..\..\src\caQtDM.ico" />
        <Binary Id="caQtDM.exe" SourceFile="..\..\..\caQtDM_Binaries\caQtDM.exe" />
        <InstallExecuteSequence>
            <CreateFolders />
            <FileCost />
            <RemoveExistingProducts Before="InstallInitialize" />
        </InstallExecuteSequence>
        <WixVariable Id="WixUILicenseRtf" Value="gplv3.rtf" />
        <WixVariable Id="WixUIDialogBmp" Value="PSI_Background.bmp" />
        <UI />
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFiles64Folder" Name="PFiles">
                <Directory Id="INSTALLDIR" Name="caQTDM">
                    <Directory Name="bin" Id="BIN">
                        <Directory Name="windows-x64" Id="WINDOWS_X64">
                            <Component Id="Qt_5.3.1" Guid="30F3975A-A151-4A59-9C05-658F0319F3F7" Win64="yes">
                                <File Id="DESIGNER.EXE" Name="designer.exe" Source="$(env.QTHOME)\bin\designer.exe" />
                                <File Id="ASSISTANT.EXE" Name="assistant.exe" Source="$(env.QTHOME)\bin\assistant.exe" />
                                <File Id="QT5QUICKPARTICLES.DLL" Name="Qt5QuickParticles.dll" Source="$(env.QTHOME)\bin\Qt5QuickParticles.dll" />
                                <File Id="QT5QUICKTEST.DLL" Name="Qt5QuickTest.dll" Source="$(env.QTHOME)\bin\Qt5QuickTest.dll" />
                                <File Id="QT5QUICKWIDGETS.DLL" Name="Qt5QuickWidgets.dll" Source="$(env.QTHOME)\bin\Qt5QuickWidgets.dll" />
                                <File Id="QT5SCRIPT.DLL" Name="Qt5Script.dll" Source="$(env.QTHOME)\bin\Qt5Script.dll" />
                                <File Id="QT5SCRIPTTOOLS.DLL" Name="Qt5ScriptTools.dll" Source="$(env.QTHOME)\bin\Qt5ScriptTools.dll" />
                                <File Id="QT5SENSORS.DLL" Name="Qt5Sensors.dll" Source="$(env.QTHOME)\bin\Qt5Sensors.dll" />
                                <File Id="QT5SERIALPORT.DLL" Name="Qt5SerialPort.dll" Source="$(env.QTHOME)\bin\Qt5SerialPort.dll" />
                                <File Id="QT5SQL.DLL" Name="Qt5Sql.dll" Source="$(env.QTHOME)\bin\Qt5Sql.dll" />
                                <File Id="QT5SVG.DLL" Name="Qt5Svg.dll" Source="$(env.QTHOME)\bin\Qt5Svg.dll" />
                                <File Id="QT5TEST.DLL" Name="Qt5Test.dll" Source="$(env.QTHOME)\bin\Qt5Test.dll" />
                                <File Id="QT5WEBSOCKETS.DLL" Name="Qt5WebSockets.dll" Source="$(env.QTHOME)\bin\Qt5WebSockets.dll" />
                                <File Id="QT5WIDGETS.DLL" Name="Qt5Widgets.dll" Source="$(env.QTHOME)\bin\Qt5Widgets.dll" />
                                <File Id="QT5WINEXTRAS.DLL" Name="Qt5WinExtras.dll" Source="$(env.QTHOME)\bin\Qt5WinExtras.dll" />
                                <File Id="QT5XML.DLL" Name="Qt5Xml.dll" Source="$(env.QTHOME)\bin\Qt5Xml.dll" />
                                <File Id="QT5XMLPATTERNS.DLL" Name="Qt5XmlPatterns.dll" Source="$(env.QTHOME)\bin\Qt5XmlPatterns.dll" />
                                <File Id="LIBEGL.DLL" Name="libEGL.dll" Source="$(env.QTHOME)\bin\libEGL.dll" />
                                <File Id="LIBGLESV2.DLL" Name="libGLESv2.dll" Source="$(env.QTHOME)\bin\libGLESv2.dll" />
                                <File Id="QT5BLUETOOTH.DLL" Name="Qt5Bluetooth.dll" Source="$(env.QTHOME)\bin\Qt5Bluetooth.dll" />
                                <File Id="QT5CLUCENE.DLL" Name="Qt5CLucene.dll" Source="$(env.QTHOME)\bin\Qt5CLucene.dll" />
                                <File Id="QT5CONCURRENT.DLL" Name="Qt5Concurrent.dll" Source="$(env.QTHOME)\bin\Qt5Concurrent.dll" />
                                <File Id="QT5CORE.DLL" Name="Qt5Core.dll" Source="$(env.QTHOME)\bin\Qt5Core.dll" />
                                <File Id="QT5DECLARATIVE.DLL" Name="Qt5Declarative.dll" Source="$(env.QTHOME)\bin\Qt5Declarative.dll" />
                                <File Id="QT5DESIGNER.DLL" Name="Qt5Designer.dll" Source="$(env.QTHOME)\bin\Qt5Designer.dll" />
                                <File Id="QT5DESIGNERCOMPONENTS.DLL" Name="Qt5DesignerComponents.dll" Source="$(env.QTHOME)\bin\Qt5DesignerComponents.dll" />
                                <File Id="QT5GUI.DLL" Name="Qt5Gui.dll" Source="$(env.QTHOME)\bin\Qt5Gui.dll" />
                                <File Id="QT5HELP.DLL" Name="Qt5Help.dll" Source="$(env.QTHOME)\bin\Qt5Help.dll" />
                                <File Id="QT5MULTIMEDIA.DLL" Name="Qt5Multimedia.dll" Source="$(env.QTHOME)\bin\Qt5Multimedia.dll" />
                                <File Id="QT5MULTIMEDIAQUICK_P.DLL" Name="Qt5MultimediaQuick_p.dll" Source="$(env.QTHOME)\bin\Qt5MultimediaQuick_p.dll" />
                                <File Id="QT5MULTIMEDIAWIDGETS.DLL" Name="Qt5MultimediaWidgets.dll" Source="$(env.QTHOME)\bin\Qt5MultimediaWidgets.dll" />
                                <File Id="QT5NETWORK.DLL" Name="Qt5Network.dll" Source="$(env.QTHOME)\bin\Qt5Network.dll" />
                                <File Id="QT5NFC.DLL" Name="Qt5Nfc.dll" Source="$(env.QTHOME)\bin\Qt5Nfc.dll" />
                                <File Id="QT5OPENGL.DLL" Name="Qt5OpenGL.dll" Source="$(env.QTHOME)\bin\Qt5OpenGL.dll" />
                                <File Id="QT5POSITIONING.DLL" Name="Qt5Positioning.dll" Source="$(env.QTHOME)\bin\Qt5Positioning.dll" />
                                <File Id="QT5PRINTSUPPORT.DLL" Name="Qt5PrintSupport.dll" Source="$(env.QTHOME)\bin\Qt5PrintSupport.dll" />
                                <File Id="QT5QML.DLL" Name="Qt5Qml.dll" Source="$(env.QTHOME)\bin\Qt5Qml.dll" />
                                <File Id="QT5QUICK.DLL" Name="Qt5Quick.dll" Source="$(env.QTHOME)\bin\Qt5Quick.dll" />
                            </Component>
                            <Component Id="Epics_3.14.12.4" Guid="B7D7E8AE-F448-43F8-A68A-A35895605B8C" Win64="yes">
                                <File Id="CAREPEATER.EXE" Name="caRepeater.exe" Source="$(env.EPICS_BASE)\bin\$(env.EPICS_HOST_ARCH)\caRepeater.exe" />
                                <File Id="CA.DLL" Name="ca.dll" Source="$(env.EPICS_BASE)\bin\$(env.EPICS_HOST_ARCH)\ca.dll" />
                                <File Id="COM.DLL" Name="Com.dll" Source="$(env.EPICS_BASE)\bin\$(env.EPICS_HOST_ARCH)\Com.dll" />
                            </Component>
                            <Component Id="qwt_6.1.0" Guid="A6CEE0D5-9524-4F6E-A04A-0BA4A5116B35" Win64="yes">
                                <File Id="QWT.DLL" Name="qwt.dll" Source="$(env.QWTHOME)\lib\qwt.dll" />
                            </Component>
                            <Component Id="CaQtDM" Guid="ECDE0227-4100-43B8-B817-88D6BCD7FF49" Win64="yes">
                                <File Id="CAQTDM.EXE" Name="caQtDM.exe" Source="..\..\..\caQtDM_Binaries\caQtDM.exe" />
                                <File Id="QTCONTROLS.DLL" Name="qtcontrols.dll" Source="..\..\..\caQtDM_Binaries\qtcontrols.dll" />
                                <File Id="CAQTDM_LIB.DLL" Name="caQtDM_Lib.dll" Source="..\..\..\caQtDM_Binaries\caQtDM_Lib.dll" />
                                <File Id="ADL2UI.EXE" Name="adl2ui.exe" Source="..\..\..\caQtDM_Binaries\adl2ui.exe" />
                            </Component>
                        </Directory>
                    </Directory>
                    <Directory Id="PLUGINS" Name="plugins">
                        <Directory Id="ACCESSIBLE" Name="accessible">
                            <Component Id="accessible" Guid="B8D0F4E5-7877-481D-89B0-2893373F02E6" Win64="yes">
                                <File Id="QTACCESSIBLEWIDGETS.DLL" Name="qtaccessiblewidgets.dll" Source="$(env.QTHOME)\plugins\accessible\qtaccessiblewidgets.dll" />
                                <File Id="QTACCESSIBLEQUICK.DLL" Name="qtaccessiblequick.dll" Source="$(env.QTHOME)\plugins\accessible\qtaccessiblequick.dll" />
                            </Component>
                        </Directory>
                        <Directory Id="BEARER" Name="bearer">
                            <Component Id="bearer" Guid="DE99AA1C-997A-4453-9795-C178EFB1009E" Win64="yes">
                                <File Id="QNATIVEWIFIBEARER.DLL" Name="qnativewifibearer.dll" Source="$(env.QTHOME)\plugins\bearer\qnativewifibearer.dll" />
                                <File Id="QGENERICBEARER.DLL" Name="qgenericbearer.dll" Source="$(env.QTHOME)\plugins\bearer\qgenericbearer.dll" />
                            </Component>
                        </Directory>
                        <Directory Id="DESIGNER" Name="designer">
                            <Component Id="designer" Guid="C07C30FC-D521-421A-8254-771A42222C4A" Win64="yes">
                                <File Id="QTCONTROLS_CONTROLLERS_PLUGIN.DLL" Name="qtcontrols_controllers_plugin.dll" Source="..\..\..\caQtDM_Binaries\designer\qtcontrols_controllers_plugin.dll" />
                                <File Id="QTCONTROLS_MONITORS_PLUGIN.DLL" Name="qtcontrols_monitors_plugin.dll" Source="..\..\..\caQtDM_Binaries\designer\qtcontrols_monitors_plugin.dll" />
                                <File Id="QTCONTROLS_GRAPHICS_PLUGIN.DLL" Name="qtcontrols_graphics_plugin.dll" Source="..\..\..\caQtDM_Binaries\designer\qtcontrols_graphics_plugin.dll" />
                            </Component>
                        </Directory>
                        <Directory Id="PLATFORMS" Name="platforms">
                            <Component Id="platforms" Guid="E774C793-5FDB-4609-A9F4-98B7796F04B1" Win64="yes">
                                <File Id="QMINIMAL.DLL" Name="qminimal.dll" Source="$(env.QTHOME)\plugins\platforms\qminimal.dll" />
                                <File Id="QOFFSCREEN.DLL" Name="qoffscreen.dll" Source="$(env.QTHOME)\plugins\platforms\qoffscreen.dll" />
                                <File Id="QWINDOWS.DLL" Name="qwindows.dll" Source="$(env.QTHOME)\plugins\platforms\qwindows.dll" />
                            </Component>
                        </Directory>
                    </Directory>
                    <Directory Id="StyleSheet" Name="StyleSheet">
                        <Component Id="Stylesheet" Guid="6D848A8A-210B-4246-B86E-819E0C51AEFE" Win64="yes">
                            <File Id="STYLESHEET.QSS" Name="stylesheet.qss" Source="..\..\parser\stylesheet.qss" />
                        </Component>
                    </Directory>
                </Directory>
                <Merge Id="VCRedist" Language="0" SourceFile="C:\Program Files (x86)\Common Files\Merge Modules\Microsoft_VC120_CRT_x64.msm" DiskId="1" />
            </Directory>
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ProgramMenuDir" Name="caQtDM">
                    <Component Id="StartMenuShortcuts" Guid="3DB7C20F-EA04-40D1-BF31-3ADDB310127F">
                        <RemoveFolder Id="ProgramMenuDir" On="uninstall" />
                        <RegistryValue Root="HKCU" Key="Software\[Manufacturer]\[ProductName]" Type="string" Value="" />
                        <Shortcut Id="UninstallProduct" Name="Uninstall" Description="Uninstalls the application" Target="[System64Folder]msiexec.exe" Arguments="/x [ProductCode]" />
                        <Shortcut Id="CaQtDM_ShortCut" Name="CaQtDM" Target="[INSTALLDIR]bin\windows-x64\caQtDM.exe" Arguments=" -style plastique">
                        </Shortcut>
                        <Shortcut Id="Designer_Shortcut" Name="Designer" Target="[INSTALLDIR]bin\windows-x64\designer.exe" />
                    </Component>
                </Directory>
            </Directory>
            <Component Id="Environment" Guid="C071FF0B-D353-4DA0-9C0F-D07FC5FF2CFE">
                <Environment Id="QT_PLUGIN_PATH" Action="set" Name="QT_PLUGIN_PATH" Part="last" Permanent="no" Value="[INSTALLDIR]plugins" System="yes" />
                <Environment Id="PATH" Name="PATH" Part="last" Permanent="no" Action="set" Value="[INSTALLDIR]bin\windows-x64\" System="yes" Separator=";" />
                <Environment Id="CAQTDM_DISPLAY_PATH" Name="CAQTDM_DISPLAY_PATH" Action="set" Permanent="no" System="yes" Value="[INSTALLDIR]StyleSheet" />
            </Component>
        </Directory>
        <Feature Id="DefaultFeature" Title="Main Feature" Level="1" ConfigurableDirectory="INSTALLDIR">
            <ComponentRef Id="Qt_5.3.1" />
            <ComponentRef Id="Epics_3.14.12.4" />
            <ComponentRef Id="qwt_6.1.0" />
            <ComponentRef Id="CaQtDM" />
            <ComponentRef Id="accessible" />
            <ComponentRef Id="bearer" />
            <ComponentRef Id="designer" />
            <ComponentRef Id="Stylesheet" />
            <ComponentRef Id="StartMenuShortcuts" />
            <ComponentRef Id="Environment" />
            <ComponentRef Id="platforms" />
        </Feature>
        <Feature Id="VCRedist" Level="1" Title="Visual C++ 10.0 Runtime" AllowAdvertise="no" Display="hidden">
            <MergeRef Id="VCRedist" />
        </Feature>
    </Product>
</Wix>